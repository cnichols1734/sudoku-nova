<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>SUDOKU NOVA ✦</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;600;700;800&family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Particle Canvas Background -->
    <canvas id="particles"></canvas>
    
    <!-- Main Game Container -->
    <div id="app">
        <!-- Header -->
        <header class="game-header">
            <div class="logo">
                <span class="logo-icon"><i data-lucide="sparkles"></i></span>
                <span class="logo-text">SUDOKU NOVA</span>
            </div>
            <div class="header-stats">
                <button class="sound-toggle" id="sound-toggle" title="Toggle Sound">
                    <svg class="sound-icon sound-on" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M11 5L6 9H2v6h4l5 4V5z"/>
                        <path class="sound-wave wave-1" d="M15.54 8.46a5 5 0 0 1 0 7.07"/>
                        <path class="sound-wave wave-2" d="M18.07 5.93a9 9 0 0 1 0 12.14"/>
                    </svg>
                    <svg class="sound-icon sound-off" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M11 5L6 9H2v6h4l5 4V5z"/>
                        <line x1="23" y1="9" x2="17" y2="15"/>
                        <line x1="17" y1="9" x2="23" y2="15"/>
                    </svg>
                </button>
                <div class="stat streak">
                    <span class="stat-icon"><i data-lucide="flame"></i></span>
                    <span class="stat-value" id="streak">0</span>
                </div>
                <div class="stat level">
                    <span class="stat-icon"><i data-lucide="star"></i></span>
                    <span class="stat-value" id="level">1</span>
                </div>
            </div>
        </header>

        <!-- Game Stats Bar -->
        <div class="stats-bar">
            <div class="stat-item">
                <span class="stat-label">SCORE</span>
                <span class="stat-number" id="score">0</span>
            </div>
            <div class="stat-item combo-container">
                <span class="stat-label">COMBO</span>
                <span class="stat-number combo-display" id="combo">x1</span>
                <div class="combo-timer-bar" id="combo-timer-bar">
                    <div class="combo-timer-fill" id="combo-timer-fill"></div>
                </div>
            </div>
            <div class="stat-item">
                <span class="stat-label">TIME</span>
                <span class="stat-number" id="timer">00:00</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">HIGH</span>
                <span class="stat-number" id="high-score">0</span>
            </div>
        </div>

        <!-- XP Progress Bar -->
        <div class="xp-bar-container">
            <div class="xp-bar">
                <div class="xp-fill" id="xp-fill"></div>
            </div>
            <span class="xp-text" id="xp-text">0 / 100 XP</span>
        </div>

        <!-- Sudoku Grid -->
        <div class="grid-container">
            <div class="grid-glow"></div>
            <div id="sudoku-grid" class="sudoku-grid"></div>
            <!-- Blast overlay for effects -->
            <div id="blast-overlay" class="blast-overlay"></div>
        </div>

        <!-- Power-ups -->
        <div class="powerups">
            <button class="powerup" id="powerup-hint" data-count="3">
                <span class="powerup-icon"><i data-lucide="lightbulb"></i></span>
                <span class="powerup-name">Hint</span>
                <span class="powerup-count">3</span>
            </button>
            <button class="powerup" id="powerup-freeze" data-count="2">
                <span class="powerup-icon"><i data-lucide="snowflake"></i></span>
                <span class="powerup-name">Freeze</span>
                <span class="powerup-count">2</span>
            </button>
            <button class="powerup" id="powerup-blast" data-count="1">
                <span class="powerup-icon"><i data-lucide="zap"></i></span>
                <span class="powerup-name">Blast</span>
                <span class="powerup-count">1</span>
            </button>
        </div>

        <!-- Number Pad -->
        <div class="number-pad">
            <button class="num-btn" data-num="1">1</button>
            <button class="num-btn" data-num="2">2</button>
            <button class="num-btn" data-num="3">3</button>
            <button class="num-btn" data-num="4">4</button>
            <button class="num-btn" data-num="5">5</button>
            <button class="num-btn" data-num="6">6</button>
            <button class="num-btn" data-num="7">7</button>
            <button class="num-btn" data-num="8">8</button>
            <button class="num-btn" data-num="9">9</button>
        </div>

        <!-- Action Buttons -->
        <div class="action-buttons">
            <button class="action-btn" id="btn-undo">
                <span class="action-icon"><i data-lucide="undo-2"></i></span>
                <span>Undo</span>
            </button>
            <button class="action-btn" id="btn-notes">
                <span class="action-icon"><i data-lucide="pencil"></i></span>
                <span>Notes</span>
            </button>
            <button class="action-btn" id="btn-erase">
                <span class="action-icon"><i data-lucide="eraser"></i></span>
                <span>Erase</span>
            </button>
            <button class="action-btn" id="btn-new">
                <span class="action-icon"><i data-lucide="refresh-cw"></i></span>
                <span>New</span>
            </button>
        </div>

        <!-- Difficulty Selector (hidden by default) -->
        <div id="difficulty-modal" class="modal">
            <div class="modal-content difficulty-modal-content">
                <!-- Tabs -->
                <div class="modal-tabs">
                    <button class="modal-tab active" data-tab="play">PLAY</button>
                    <button class="modal-tab" data-tab="stats">STATS</button>
                    <button class="modal-tab" data-tab="ranks">RANKS</button>
                    <button class="modal-tab" data-tab="howto">HOW TO</button>
                </div>

                <!-- Play Tab -->
                <div class="tab-content active" id="tab-play">
                    <h2>SELECT DIFFICULTY</h2>
                    <div class="difficulty-options">
                        <button class="diff-btn" data-difficulty="easy">
                            <span class="diff-stars"><i data-lucide="star"></i></span>
                            <span class="diff-name">EASY</span>
                            <span class="diff-desc">Perfect for warming up</span>
                        </button>
                        <button class="diff-btn" data-difficulty="medium">
                            <span class="diff-stars"><i data-lucide="star"></i><i data-lucide="star"></i></span>
                            <span class="diff-name">MEDIUM</span>
                            <span class="diff-desc">A balanced challenge</span>
                        </button>
                        <button class="diff-btn" data-difficulty="hard">
                            <span class="diff-stars"><i data-lucide="star"></i><i data-lucide="star"></i><i data-lucide="star"></i></span>
                            <span class="diff-name">HARD</span>
                            <span class="diff-desc">For true masters</span>
                        </button>
                        <button class="diff-btn" data-difficulty="expert">
                            <span class="diff-stars"><i data-lucide="star"></i><i data-lucide="star"></i><i data-lucide="star"></i><i data-lucide="star"></i></span>
                            <span class="diff-name">EXPERT</span>
                            <span class="diff-desc">Ultimate test</span>
                        </button>
                    </div>
                </div>

                <!-- Stats Tab -->
                <div class="tab-content" id="tab-stats">
                    <div class="stats-grid">
                        <!-- Overview -->
                        <div class="stats-card stats-overview">
                            <div class="stats-card-header">
                                <i data-lucide="trophy"></i>
                                <h3>Overview</h3>
                            </div>
                            <div class="stats-row">
                                <span class="stats-label">Total Puzzles</span>
                                <span class="stats-value" id="stat-total-puzzles">0</span>
                            </div>
                            <div class="stats-row">
                                <span class="stats-label">Perfect Games</span>
                                <span class="stats-value gold" id="stat-perfect-games">0</span>
                            </div>
                            <div class="stats-row">
                                <span class="stats-label">Current Level</span>
                                <span class="stats-value" id="stat-current-level">1</span>
                            </div>
                            <div class="stats-row">
                                <span class="stats-label">Total XP Earned</span>
                                <span class="stats-value" id="stat-total-xp">0</span>
                            </div>
                            <div class="stats-row">
                                <span class="stats-label">Longest Streak</span>
                                <span class="stats-value flame" id="stat-longest-streak">0</span>
                            </div>
                        </div>
                        
                        <!-- Puzzles by Difficulty -->
                        <div class="stats-card">
                            <div class="stats-card-header">
                                <i data-lucide="grid-3x3"></i>
                                <h3>Completed</h3>
                            </div>
                            <div class="stats-row">
                                <span class="stats-label"><i data-lucide="star"></i> Easy</span>
                                <span class="stats-value" id="stat-easy-completed">0</span>
                            </div>
                            <div class="stats-row">
                                <span class="stats-label"><i data-lucide="star"></i><i data-lucide="star"></i> Medium</span>
                                <span class="stats-value" id="stat-medium-completed">0</span>
                            </div>
                            <div class="stats-row">
                                <span class="stats-label"><i data-lucide="star"></i><i data-lucide="star"></i><i data-lucide="star"></i> Hard</span>
                                <span class="stats-value" id="stat-hard-completed">0</span>
                            </div>
                            <div class="stats-row">
                                <span class="stats-label"><i data-lucide="star"></i><i data-lucide="star"></i><i data-lucide="star"></i><i data-lucide="star"></i> Expert</span>
                                <span class="stats-value" id="stat-expert-completed">0</span>
                            </div>
                        </div>
                        
                        <!-- Best Times -->
                        <div class="stats-card">
                            <div class="stats-card-header">
                                <i data-lucide="timer"></i>
                                <h3>Best Times</h3>
                            </div>
                            <div class="stats-row">
                                <span class="stats-label">Easy</span>
                                <span class="stats-value time" id="stat-easy-best">--:--</span>
                            </div>
                            <div class="stats-row">
                                <span class="stats-label">Medium</span>
                                <span class="stats-value time" id="stat-medium-best">--:--</span>
                            </div>
                            <div class="stats-row">
                                <span class="stats-label">Hard</span>
                                <span class="stats-value time" id="stat-hard-best">--:--</span>
                            </div>
                            <div class="stats-row">
                                <span class="stats-label">Expert</span>
                                <span class="stats-value time" id="stat-expert-best">--:--</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Ranks/Leaderboard Tab -->
                <div class="tab-content" id="tab-ranks">
                    <div class="leaderboard-header">
                        <h2><i data-lucide="trophy"></i> GLOBAL RANKS</h2>
                        <div class="leaderboard-filters">
                            <button class="lb-filter active" data-sort="level">Level</button>
                            <button class="lb-filter" data-sort="total_xp">XP</button>
                            <button class="lb-filter" data-sort="puzzles_completed">Puzzles</button>
                        </div>
                    </div>
                    
                    <div class="your-rank-card" id="your-rank-card">
                        <div class="your-rank-label">YOUR RANK</div>
                        <div class="your-rank-info">
                            <span class="your-rank-position" id="your-rank-position">#--</span>
                            <span class="your-rank-name" id="your-rank-name">Loading...</span>
                            <span class="your-rank-stat" id="your-rank-stat">--</span>
                        </div>
                    </div>
                    
                    <div class="leaderboard-list" id="leaderboard-list">
                        <div class="leaderboard-loading">
                            <i data-lucide="loader-2" class="spin"></i>
                            <span>Loading leaderboard...</span>
                        </div>
                    </div>
                    
                    <div class="name-editor" id="name-editor">
                        <label for="player-name-input">Your Display Name:</label>
                        <div class="name-input-row">
                            <input type="text" id="player-name-input" maxlength="20" placeholder="Anonymous">
                            <button id="save-name-btn"><i data-lucide="check"></i></button>
                        </div>
                    </div>
                </div>

                <!-- How to Play Tab -->
                <div class="tab-content" id="tab-howto">
                    <div class="howto-scroll">
                        <!-- Basic Rules -->
                        <div class="howto-section">
                            <h3><i data-lucide="clipboard-list"></i> Basic Rules</h3>
                            <p>Fill the 9×9 grid so that each <strong>row</strong>, <strong>column</strong>, and <strong>3×3 box</strong> contains all digits from 1-9 without repeating.</p>
                        </div>

                        <!-- Scoring -->
                        <div class="howto-section">
                            <h3><i data-lucide="target"></i> Scoring System</h3>
                            <div class="howto-item">
                                <span class="howto-icon"><i data-lucide="check"></i></span>
                                <div>
                                    <strong>Correct Placement</strong>
                                    <p>+10 points × current combo multiplier</p>
                                </div>
                            </div>
                            <div class="howto-item">
                                <span class="howto-icon"><i data-lucide="flame"></i></span>
                                <div>
                                    <strong>Region Complete</strong>
                                    <p>+50 points × combo when you complete a row, column, or 3×3 box</p>
                                </div>
                            </div>
                        </div>

                        <!-- Combo System -->
                        <div class="howto-section">
                            <h3><i data-lucide="zap"></i> Combo Multiplier</h3>
                            <p>Build combos by completing rows, columns, or boxes!</p>
                            <div class="howto-item">
                                <span class="howto-icon highlight">x1→x10</span>
                                <div>
                                    <strong>Max Combo: x10</strong>
                                    <p>Each region completion adds +1 to your multiplier</p>
                                </div>
                            </div>
                            <div class="howto-item">
                                <span class="howto-icon"><i data-lucide="timer"></i></span>
                                <div>
                                    <strong>Combo Timer: 35 seconds</strong>
                                    <p>Complete another region within 35s to keep your combo alive!</p>
                                </div>
                            </div>
                            <div class="howto-item">
                                <span class="howto-icon warning"><i data-lucide="x"></i></span>
                                <div>
                                    <strong>Combo Reset</strong>
                                    <p>Wrong answers reset your combo to x1</p>
                                </div>
                            </div>
                        </div>

                        <!-- Power-ups -->
                        <div class="howto-section">
                            <h3><i data-lucide="sparkles"></i> Power-Ups</h3>
                            <div class="howto-item powerup-item">
                                <span class="howto-icon powerup-hint"><i data-lucide="lightbulb"></i></span>
                                <div>
                                    <strong>Hint</strong>
                                    <p>Reveals the correct number for the selected cell. No combo bonus for hints.</p>
                                </div>
                            </div>
                            <div class="howto-item powerup-item">
                                <span class="howto-icon powerup-freeze"><i data-lucide="snowflake"></i></span>
                                <div>
                                    <strong>Freeze Time</strong>
                                    <p>Pauses the timer for <strong>30 seconds</strong>. Great for thinking through tough spots!</p>
                                </div>
                            </div>
                            <div class="howto-item powerup-item">
                                <span class="howto-icon powerup-blast"><i data-lucide="zap"></i></span>
                                <div>
                                    <strong>Blast</strong>
                                    <p>Auto-fills up to <strong>3 cells</strong> in the same 3×3 box as your selected cell.</p>
                                </div>
                            </div>
                        </div>

                        <!-- XP & Leveling -->
                        <div class="howto-section">
                            <h3><i data-lucide="star"></i> XP & Leveling</h3>
                            <div class="howto-item">
                                <span class="howto-icon"><i data-lucide="trending-up"></i></span>
                                <div>
                                    <strong>Earn XP</strong>
                                    <p>Gain XP equal to 10% of your score. Complete puzzles for bonus XP!</p>
                                </div>
                            </div>
                            <div class="howto-item">
                                <span class="howto-icon"><i data-lucide="gift"></i></span>
                                <div>
                                    <strong>Power-ups Per Game</strong>
                                    <p>Each new game gives you fresh power-ups based on your level:<br>
                                    <strong>Base:</strong> 2 Hints, 1 Freeze, 1 Blast<br>
                                    <strong>+1 Hint</strong> every 5 levels<br>
                                    <strong>+1 Freeze</strong> every 10 levels<br>
                                    <strong>+1 Blast</strong> every 15 levels</p>
                                </div>
                            </div>
                        </div>

                        <!-- Streaks -->
                        <div class="howto-section">
                            <h3><i data-lucide="flame"></i> Daily Streaks</h3>
                            <p>Complete at least one puzzle each day to build your streak! Miss a day and it resets to zero.</p>
                        </div>

                        <!-- Stars -->
                        <div class="howto-section">
                            <h3><i data-lucide="trophy"></i> Star Ratings</h3>
                            <div class="star-ratings">
                                <div class="star-row">
                                    <span class="star-icons"><i data-lucide="star"></i><i data-lucide="star"></i><i data-lucide="star"></i></span>
                                    <span>Complete in under 50% of target time</span>
                                </div>
                                <div class="star-row">
                                    <span class="star-icons"><i data-lucide="star"></i><i data-lucide="star"></i></span>
                                    <span>Complete in under target time</span>
                                </div>
                                <div class="star-row">
                                    <span class="star-icons"><i data-lucide="star"></i></span>
                                    <span>Complete the puzzle</span>
                                </div>
                            </div>
                            <p class="target-times"><strong>Target times:</strong> Easy 5min, Medium 10min, Hard 15min, Expert 20min</p>
                        </div>

                        <!-- Tips -->
                        <div class="howto-section">
                            <h3><i data-lucide="lightbulb"></i> Pro Tips</h3>
                            <ul class="tips-list">
                                <li>Use <strong>Notes mode</strong> to mark possible numbers</li>
                                <li>Complete multiple regions quickly for massive combo bonuses</li>
                                <li>Save power-ups for when you're really stuck</li>
                                <li>Freeze time during complex solving sequences</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Victory Modal -->
        <div id="victory-modal" class="modal">
            <div class="modal-content victory">
                <div class="victory-stars" id="victory-stars">
                    <i data-lucide="star"></i><i data-lucide="star"></i><i data-lucide="star"></i>
                </div>
                <div class="perfect-badge" id="perfect-badge">
                    <i data-lucide="sparkles"></i>
                    <span>PERFECT!</span>
                </div>
                <h2>PUZZLE COMPLETE!</h2>
                <div class="victory-stats">
                    <div class="v-stat">
                        <span class="v-label">Time</span>
                        <span class="v-value" id="v-time">00:00</span>
                    </div>
                    <div class="v-stat">
                        <span class="v-label">Score</span>
                        <span class="v-value" id="v-score">0</span>
                    </div>
                    <div class="v-stat">
                        <span class="v-label">Max Combo</span>
                        <span class="v-value" id="v-combo">x1</span>
                    </div>
                    <div class="v-stat">
                        <span class="v-label">XP Earned</span>
                        <span class="v-value" id="v-xp">+0</span>
                    </div>
                </div>
                <div class="victory-buttons">
                    <button class="victory-btn primary" id="btn-next">NEXT PUZZLE</button>
                    <button class="victory-btn" id="btn-share">SHARE</button>
                </div>
            </div>
        </div>

        <!-- Combo Popup -->
        <div id="combo-popup" class="combo-popup">
            <span class="combo-text">COMBO x2!</span>
        </div>
    </div>

    <script src="game.js"></script>
</body>
</html>

